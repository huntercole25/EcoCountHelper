ChangeTab <- data.table::data.table(Predictors = Predictors, UnitCh = UnitChanges)
if(is.null(ScaleSds)==F){ChangeTab[,PredCol := PredVects]}
for(i in Models){
TmpMod <- get(i, envir = .GlobalEnv)
Group <- regmatches(i, regexpr(GroupPat, i))
for(j in 1:nrow(ChangeTab)){
Predictor <- ChangeTab[j,Predictors]
UnitChange <- ChangeTab[j,UnitCh]
PredBeta <- summary(TmpMod)$coeff$cond[Predictor,1]
PredSe <- summary(TmpMod)$coeff$cond[Predictor,2]
if(is.null(ScaleSds) == T){
TmpDat <- data.table::data.table(
Model = i,
Predictor = ChangeTab[j,Predictors],
DeltaPct = (-(1-exp(PredBeta)^UnitChange))*100)
TmpDat[,LowerConf := DeltaPct -
((-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)))^UnitChange)*100)]
TmpDat[,UpperConf := DeltaPct +
((-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)))^UnitChange)*100)]
}else{
PredColName <- ChangeTab[j,PredCol]
PredVect <- Data[[PredColName]][Data[[GroupCol]] == Group]
TmpDat <- data.table::data.table(
Model = i,
Predictor = ChangeTab[j,Predictors],
DeltaPct = (-(1-exp(PredBeta/(ScaleSds*stats::sd(PredVect)))^UnitChange))*100)
TmpDat[,LowerConf := DeltaPct -
(-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)/
(ScaleSds*stats::sd(PredVect)))^UnitChange))*100]
TmpDat[,UpperConf := DeltaPct +
(-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)/
(ScaleSds*stats::sd(PredVect)))^UnitChange))*100]
}
FullEffects <- c(FullEffects, list(TmpDat))
}
}
data.table::rbindlist(FullEffects)
}
RealEffectTabLong <- function(Models, Predictors, UnitChanges, ConfInt = 95, GroupPat, GroupCol,
ScaleSds = NULL, PredVects = NULL, Data = NULL){
if("glmmTMB" %in% class(Models)){
Models <- deparse(substitute(Models))
}
FullEffects <- list()
ChangeTab <- data.table::data.table(Predictors = Predictors, UnitCh = UnitChanges)
if(is.null(ScaleSds)==F){ChangeTab[,PredCol := PredVects]}
for(i in Models){
TmpMod <- get(i, envir = .GlobalEnv)
Group <- regmatches(i, regexpr(GroupPat, i))
for(j in 1:nrow(ChangeTab)){
Predictor <- ChangeTab[j,Predictors]
UnitChange <- ChangeTab[j,UnitCh]
PredBeta <- summary(TmpMod)$coeff$cond[Predictor,1]
PredSe <- summary(TmpMod)$coeff$cond[Predictor,2]
if(is.null(ScaleSds) == T){
TmpDat <- data.table::data.table(
Model = i,
Predictor = ChangeTab[j,Predictors],
DeltaPct = (-(1-exp(PredBeta)^UnitChange))*100)
TmpDat[,LowerConf := DeltaPct -
((-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)))^UnitChange)*100)]
TmpDat[,UpperConf := DeltaPct +
((-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)))^UnitChange)*100)]
}else{
PredColName <- ChangeTab[j,PredCol]
PredVect <- Data[[PredColName]][Data[[GroupCol]] == Group]
TmpDat <- data.table::data.table(
Model = i,
Predictor = ChangeTab[j,Predictors],
DeltaPct = (-(1-exp(PredBeta/(ScaleSds*stats::sd(PredVect)))^UnitChange))*100)
TmpDat[,LowerConf := DeltaPct -
(-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)/
(ScaleSds*stats::sd(PredVect)))^UnitChange))*100]
TmpDat[,UpperConf := DeltaPct +
(-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)/
(ScaleSds*stats::sd(PredVect)))^UnitChange))*100]
}
FullEffects <- c(FullEffects, list(TmpDat))
}
}
data.table::rbindlist(FullEffects)
}
RealEffectTabLong(MyluMod, Predictors = c("YdayScale", "MoonScale"), UnitChanges = c(10, 0.5), GroupPat = "[[:alpha:]]{4}", GroupCol = "Species", ScaleSds = 2, Data = junk)
RealEffectTabLong(MyluMod, Predictors = c("YdayScale", "MoonScale"), UnitChanges = c(10, 0.5), GroupPat = "[[:alpha:]]{4}", GroupCol = "Species", ScaleSds = 2, PredVects = c("Yday", "MoonPct"), Data = junk)
RealEffectTabLong <- function(Models, Predictors, UnitChanges, ConfInt = 95, GroupPat, GroupCol,
ScaleSds = NULL, PredVects = NULL, Data = NULL){
if("glmmTMB" %in% class(Models)){
Models <- deparse(substitute(Models))
}
FullEffects <- list()
ChangeTab <- data.table::data.table(Predictors = Predictors, UnitCh = UnitChanges,
ScaleSds = ScaleSds)
if(is.null(ScaleSds)==F){ChangeTab[,PredCol := PredVects]}
for(i in Models){
TmpMod <- get(i, envir = .GlobalEnv)
Group <- regmatches(i, regexpr(GroupPat, i))
for(j in 1:nrow(ChangeTab)){
Predictor <- ChangeTab[j,Predictors]
UnitChange <- ChangeTab[j,UnitCh]
PredBeta <- summary(TmpMod)$coeff$cond[Predictor,1]
PredSe <- summary(TmpMod)$coeff$cond[Predictor,2]
if(is.na(ScaleSds) == T){
TmpDat <- data.table::data.table(
Model = i,
Predictor = ChangeTab[j,Predictors],
DeltaPct = (-(1-exp(PredBeta)^UnitChange))*100)
TmpDat[,LowerConf := DeltaPct -
((-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)))^UnitChange)*100)]
TmpDat[,UpperConf := DeltaPct +
((-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)))^UnitChange)*100)]
}else{
PredColName <- ChangeTab[j,PredCol]
PredVect <- Data[[PredColName]][Data[[GroupCol]] == Group]
TmpDat <- data.table::data.table(
Model = i,
Predictor = ChangeTab[j,Predictors],
DeltaPct = (-(1-exp(PredBeta/(ScaleSds*stats::sd(PredVect)))^UnitChange))*100)
TmpDat[,LowerConf := DeltaPct -
(-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)/
(ScaleSds*stats::sd(PredVect)))^UnitChange))*100]
TmpDat[,UpperConf := DeltaPct +
(-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)/
(ScaleSds*stats::sd(PredVect)))^UnitChange))*100]
}
FullEffects <- c(FullEffects, list(TmpDat))
}
}
data.table::rbindlist(FullEffects)
}
RealEffectTabLong(MyluMod, Predictors = c("YdayScale", "MoonScale"), UnitChanges = c(10, 0.5), GroupPat = "[[:alpha:]]{4}", GroupCol = "Species", ScaleSds = c(2,2), PredVects = c("Yday", "MoonPct"), Data = junk)
RealEffectTabLong <- function(Models, Predictors, UnitChanges, ConfInt = 95, GroupPat, GroupCol,
ScaleSds = NULL, PredVects = NULL, Data = NULL){
if("glmmTMB" %in% class(Models)){
Models <- deparse(substitute(Models))
}
FullEffects <- list()
ChangeTab <- data.table::data.table(Predictors = Predictors, UnitCh = UnitChanges,
ScaleSds = ScaleSds)
if(is.null(ScaleSds)==F){ChangeTab[,PredCol := PredVects]}
for(i in Models){
TmpMod <- get(i, envir = .GlobalEnv)
Group <- regmatches(i, regexpr(GroupPat, i))
for(j in 1:nrow(ChangeTab)){
Predictor <- ChangeTab[j,Predictors]
UnitChange <- ChangeTab[j,UnitCh]
PredBeta <- summary(TmpMod)$coeff$cond[Predictor,1]
PredSe <- summary(TmpMod)$coeff$cond[Predictor,2]
if(is.na(ChangeTab[j,ScaleSds]) == T){
TmpDat <- data.table::data.table(
Model = i,
Predictor = ChangeTab[j,Predictors],
DeltaPct = (-(1-exp(PredBeta)^UnitChange))*100)
TmpDat[,LowerConf := DeltaPct -
((-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)))^UnitChange)*100)]
TmpDat[,UpperConf := DeltaPct +
((-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)))^UnitChange)*100)]
}else{
PredColName <- ChangeTab[j,PredCol]
PredVect <- Data[[PredColName]][Data[[GroupCol]] == Group]
TmpDat <- data.table::data.table(
Model = i,
Predictor = ChangeTab[j,Predictors],
DeltaPct = (-(1-exp(PredBeta/(ScaleSds*stats::sd(PredVect)))^UnitChange))*100)
TmpDat[,LowerConf := DeltaPct -
(-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)/
(ScaleSds*stats::sd(PredVect)))^UnitChange))*100]
TmpDat[,UpperConf := DeltaPct +
(-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)/
(ScaleSds*stats::sd(PredVect)))^UnitChange))*100]
}
FullEffects <- c(FullEffects, list(TmpDat))
}
}
data.table::rbindlist(FullEffects)
}
RealEffectTabLong(MyluMod, Predictors = c("YdayScale", "MoonScale"), UnitChanges = c(10, 0.5), GroupPat = "[[:alpha:]]{4}", GroupCol = "Species", ScaleSds = c(2,2), PredVects = c("Yday", "MoonPct"), Data = junk)
RealEffectTabLong(MyluMod, Predictors = c("YdayScale", "MoonScale"), UnitChanges = c(10, 0.5), GroupPat = "[[:alpha:]]{4}", GroupCol = "Species", ScaleSds = c(2,NA), PredVects = c("Yday", "MoonPct"), Data = junk)
MyluMod <- glmmTMB(Count ~ Yday + MoonScale, data = junk[Species == "Mylu",], family = nbinom2())
RealEffectTabLong(MyluMod, Predictors = c("Yday", "MoonScale"), UnitChanges = c(10, 0.5), GroupPat = "[[:alpha:]]{4}", GroupCol = "Species", ScaleSds = c(NA,2), PredVects = c("Yday", "MoonPct"), Data = junk)
RealEffectTabLong <- function(Models, Predictors, UnitChanges, ConfInt = 95, GroupPat, GroupCol,
ScaleSds = NULL, PredVects = NULL, Data = NULL){
if("glmmTMB" %in% class(Models)){
Models <- deparse(substitute(Models))
}
FullEffects <- list()
ChangeTab <- data.table::data.table(Predictors = Predictors, UnitCh = UnitChanges,
ScaleSd = ScaleSds)
if(is.null(ScaleSds)==F){ChangeTab[,PredCol := PredVects]}
for(i in Models){
TmpMod <- get(i, envir = .GlobalEnv)
Group <- regmatches(i, regexpr(GroupPat, i))
for(j in 1:nrow(ChangeTab)){
Predictor <- ChangeTab[j,Predictors]
UnitChange <- ChangeTab[j,UnitCh]
PredBeta <- summary(TmpMod)$coeff$cond[Predictor,1]
PredSe <- summary(TmpMod)$coeff$cond[Predictor,2]
if(is.na(ChangeTab[j,ScaleSd]) == T){
TmpDat <- data.table::data.table(
Model = i,
Predictor = ChangeTab[j,Predictors],
DeltaPct = (-(1-exp(PredBeta)^UnitChange))*100)
TmpDat[,LowerConf := DeltaPct -
((-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)))^UnitChange)*100)]
TmpDat[,UpperConf := DeltaPct +
((-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)))^UnitChange)*100)]
}else{
PredColName <- ChangeTab[j,PredCol]
PredVect <- Data[[PredColName]][Data[[GroupCol]] == Group]
TmpDat <- data.table::data.table(
Model = i,
Predictor = ChangeTab[j,Predictors],
DeltaPct = (-(1-exp(PredBeta/(ChangeTab[j,ScaleSd]*stats::sd(PredVect)))^UnitChange))*100)
TmpDat[,LowerConf := DeltaPct -
(-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)/
(ChangeTab[j,ScaleSd]*stats::sd(PredVect)))^UnitChange))*100]
TmpDat[,UpperConf := DeltaPct +
(-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)/
(ChangeTab[j,ScaleSd]*stats::sd(PredVect)))^UnitChange))*100]
}
FullEffects <- c(FullEffects, list(TmpDat))
}
}
data.table::rbindlist(FullEffects)
}
RealEffectTabLong(MyluMod, Predictors = c("Yday", "MoonScale"), UnitChanges = c(10, 0.5), GroupPat = "[[:alpha:]]{4}", GroupCol = "Species", ScaleSds = c(NA,2), PredVects = c("Yday", "MoonPct"), Data = junk)
RealEffectTabLong <- function(Models, Predictors, UnitChanges, ConfInt = 95, GroupPat, GroupCol,
ScaleSds = NULL, PredVects = NULL, Data = NULL){
if("glmmTMB" %in% class(Models)){
Models <- deparse(substitute(Models))
}
FullEffects <- list()
ChangeTab <- data.table::data.table(Predictors = Predictors, UnitCh = UnitChanges,
ScaleSd = ScaleSds)
#if(is.na(ScaleSds)==F){ChangeTab[,PredCol := PredVects]}
for(i in Models){
TmpMod <- get(i, envir = .GlobalEnv)
Group <- regmatches(i, regexpr(GroupPat, i))
for(j in 1:nrow(ChangeTab)){
Predictor <- ChangeTab[j,Predictors]
UnitChange <- ChangeTab[j,UnitCh]
PredBeta <- summary(TmpMod)$coeff$cond[Predictor,1]
PredSe <- summary(TmpMod)$coeff$cond[Predictor,2]
if(is.na(ChangeTab[j,ScaleSd]) == T){
TmpDat <- data.table::data.table(
Model = i,
Predictor = ChangeTab[j,Predictors],
DeltaPct = (-(1-exp(PredBeta)^UnitChange))*100)
TmpDat[,LowerConf := DeltaPct -
((-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)))^UnitChange)*100)]
TmpDat[,UpperConf := DeltaPct +
((-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)))^UnitChange)*100)]
}else{
PredColName <- ChangeTab[j,PredCol]
PredVect <- Data[[PredColName]][Data[[GroupCol]] == Group]
TmpDat <- data.table::data.table(
Model = i,
Predictor = ChangeTab[j,Predictors],
DeltaPct = (-(1-exp(PredBeta/(ChangeTab[j,ScaleSd]*stats::sd(PredVect)))^UnitChange))*100)
TmpDat[,LowerConf := DeltaPct -
(-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)/
(ChangeTab[j,ScaleSd]*stats::sd(PredVect)))^UnitChange))*100]
TmpDat[,UpperConf := DeltaPct +
(-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)/
(ChangeTab[j,ScaleSd]*stats::sd(PredVect)))^UnitChange))*100]
}
FullEffects <- c(FullEffects, list(TmpDat))
}
}
data.table::rbindlist(FullEffects)
}
RealEffectTabLong(MyluMod, Predictors = c("Yday", "MoonScale"), UnitChanges = c(10, 0.5), GroupPat = "[[:alpha:]]{4}", GroupCol = "Species", ScaleSds = c(NA,2), PredVects = c("Yday", "MoonPct"), Data = junk)
RealEffectTabLong <- function(Models, Predictors, UnitChanges, ConfInt = 95, GroupPat, GroupCol,
ScaleSds = NULL, PredVects = NULL, Data = NULL){
if("glmmTMB" %in% class(Models)){
Models <- deparse(substitute(Models))
}
FullEffects <- list()
ChangeTab <- data.table::data.table(Predictors = Predictors, UnitCh = UnitChanges,
ScaleSd = ScaleSds)
for(i in Models){
TmpMod <- get(i, envir = .GlobalEnv)
Group <- regmatches(i, regexpr(GroupPat, i))
for(j in 1:nrow(ChangeTab)){
if(is.na(ChangeTab[j,ScaleSds])==F){ChangeTab[,PredCol := PredVects]}
Predictor <- ChangeTab[j,Predictors]
UnitChange <- ChangeTab[j,UnitCh]
PredBeta <- summary(TmpMod)$coeff$cond[Predictor,1]
PredSe <- summary(TmpMod)$coeff$cond[Predictor,2]
if(is.na(ChangeTab[j,ScaleSd]) == T){
TmpDat <- data.table::data.table(
Model = i,
Predictor = ChangeTab[j,Predictors],
DeltaPct = (-(1-exp(PredBeta)^UnitChange))*100)
TmpDat[,LowerConf := DeltaPct -
((-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)))^UnitChange)*100)]
TmpDat[,UpperConf := DeltaPct +
((-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)))^UnitChange)*100)]
}else{
PredColName <- ChangeTab[j,PredCol]
PredVect <- Data[[PredColName]][Data[[GroupCol]] == Group]
TmpDat <- data.table::data.table(
Model = i,
Predictor = ChangeTab[j,Predictors],
DeltaPct = (-(1-exp(PredBeta/(ChangeTab[j,ScaleSd]*stats::sd(PredVect)))^UnitChange))*100)
TmpDat[,LowerConf := DeltaPct -
(-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)/
(ChangeTab[j,ScaleSd]*stats::sd(PredVect)))^UnitChange))*100]
TmpDat[,UpperConf := DeltaPct +
(-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)/
(ChangeTab[j,ScaleSd]*stats::sd(PredVect)))^UnitChange))*100]
}
FullEffects <- c(FullEffects, list(TmpDat))
}
}
data.table::rbindlist(FullEffects)
}
RealEffectTabLong(MyluMod, Predictors = c("Yday", "MoonScale"), UnitChanges = c(10, 0.5), GroupPat = "[[:alpha:]]{4}", GroupCol = "Species", ScaleSds = c(NA,2), PredVects = c("Yday", "MoonPct"), Data = junk)
RealEffectTabLong <- function(Models, Predictors, UnitChanges, ConfInt = 95, GroupPat, GroupCol,
ScaleSds = NULL, PredVects = NULL, Data = NULL){
if("glmmTMB" %in% class(Models)){
Models <- deparse(substitute(Models))
}
FullEffects <- list()
ChangeTab <- data.table::data.table(Predictors = Predictors, UnitCh = UnitChanges,
ScaleSd = ScaleSds)
for(i in Models){
TmpMod <- get(i, envir = .GlobalEnv)
Group <- regmatches(i, regexpr(GroupPat, i))
for(j in 1:nrow(ChangeTab)){
if(is.na(ChangeTab[j,ScaleSds])==F){ChangeTab[j,PredCol := PredVects[j]]}
Predictor <- ChangeTab[j,Predictors]
UnitChange <- ChangeTab[j,UnitCh]
PredBeta <- summary(TmpMod)$coeff$cond[Predictor,1]
PredSe <- summary(TmpMod)$coeff$cond[Predictor,2]
if(is.na(ChangeTab[j,ScaleSd]) == T){
TmpDat <- data.table::data.table(
Model = i,
Predictor = ChangeTab[j,Predictors],
DeltaPct = (-(1-exp(PredBeta)^UnitChange))*100)
TmpDat[,LowerConf := DeltaPct -
((-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)))^UnitChange)*100)]
TmpDat[,UpperConf := DeltaPct +
((-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)))^UnitChange)*100)]
}else{
PredColName <- ChangeTab[j,PredCol]
PredVect <- Data[[PredColName]][Data[[GroupCol]] == Group]
TmpDat <- data.table::data.table(
Model = i,
Predictor = ChangeTab[j,Predictors],
DeltaPct = (-(1-exp(PredBeta/(ChangeTab[j,ScaleSd]*stats::sd(PredVect)))^UnitChange))*100)
TmpDat[,LowerConf := DeltaPct -
(-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)/
(ChangeTab[j,ScaleSd]*stats::sd(PredVect)))^UnitChange))*100]
TmpDat[,UpperConf := DeltaPct +
(-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)/
(ChangeTab[j,ScaleSd]*stats::sd(PredVect)))^UnitChange))*100]
}
FullEffects <- c(FullEffects, list(TmpDat))
}
}
data.table::rbindlist(FullEffects)
}
RealEffectTabLong(MyluMod, Predictors = c("Yday", "MoonScale"), UnitChanges = c(10, 0.5), GroupPat = "[[:alpha:]]{4}", GroupCol = "Species", ScaleSds = c(NA,2), PredVects = c("Yday", "MoonPct"), Data = junk)
RealEffectTabLong <- function(Models, Predictors, UnitChanges, ConfInt = 95, GroupPat, GroupCol,
ScaleSds = NULL, PredVects = NULL, Data = NULL){
if("glmmTMB" %in% class(Models)){
Models <- deparse(substitute(Models))
}
FullEffects <- list()
ChangeTab <- data.table::data.table(Predictors = Predictors, UnitCh = UnitChanges,
ScaleSd = ScaleSds)
for(i in Models){
TmpMod <- get(i, envir = .GlobalEnv)
Group <- regmatches(i, regexpr(GroupPat, i))
for(j in 1:nrow(ChangeTab)){
if(is.na(ChangeTab[j,ScaleSd])==F){ChangeTab[j,PredCol := PredVects[j]]}
Predictor <- ChangeTab[j,Predictors]
UnitChange <- ChangeTab[j,UnitCh]
PredBeta <- summary(TmpMod)$coeff$cond[Predictor,1]
PredSe <- summary(TmpMod)$coeff$cond[Predictor,2]
if(is.na(ChangeTab[j,ScaleSd]) == T){
TmpDat <- data.table::data.table(
Model = i,
Predictor = ChangeTab[j,Predictors],
DeltaPct = (-(1-exp(PredBeta)^UnitChange))*100)
TmpDat[,LowerConf := DeltaPct -
((-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)))^UnitChange)*100)]
TmpDat[,UpperConf := DeltaPct +
((-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)))^UnitChange)*100)]
}else{
PredColName <- ChangeTab[j,PredCol]
PredVect <- Data[[PredColName]][Data[[GroupCol]] == Group]
TmpDat <- data.table::data.table(
Model = i,
Predictor = ChangeTab[j,Predictors],
DeltaPct = (-(1-exp(PredBeta/(ChangeTab[j,ScaleSd]*stats::sd(PredVect)))^UnitChange))*100)
TmpDat[,LowerConf := DeltaPct -
(-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)/
(ChangeTab[j,ScaleSd]*stats::sd(PredVect)))^UnitChange))*100]
TmpDat[,UpperConf := DeltaPct +
(-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)/
(ChangeTab[j,ScaleSd]*stats::sd(PredVect)))^UnitChange))*100]
}
FullEffects <- c(FullEffects, list(TmpDat))
}
}
data.table::rbindlist(FullEffects)
}
RealEffectTabLong(MyluMod, Predictors = c("Yday", "MoonScale"), UnitChanges = c(10, 0.5), GroupPat = "[[:alpha:]]{4}", GroupCol = "Species", ScaleSds = c(NA,2), PredVects = c("Yday", "MoonPct"), Data = junk)
RealEffectTabWide <- function(Models, Predictors, UnitChanges, ConfInt = 95,
ScaleSds = NULL, PredVects = NULL, Data = NULL){
if("glmmTMB" %in% class(Models)){
Models <- deparse(substitute(Models))
}
FullEffects <- list()
ChangeTab <- data.table::data.table(Predictors = Predictors, UnitCh = UnitChanges,
ScaleSd = ScaleSds)
for(i in Models){
TmpMod <- get(i, envir = .GlobalEnv)
Group <- regmatches(i, regexpr(GroupPat, i))
for(j in 1:nrow(ChangeTab)){
if(is.na(ChangeTab[j,ScaleSd])==F){ChangeTab[j,PredCol := PredVects[j]]}
Predictor <- ChangeTab[j,Predictors]
UnitChange <- ChangeTab[j,UnitCh]
PredBeta <- summary(TmpMod)$coeff$cond[Predictor,1]
PredSe <- summary(TmpMod)$coeff$cond[Predictor,2]
if(is.na(ChangeTab[j,ScaleSd]) == T){
TmpDat <- data.table::data.table(
Model = i,
Predictor = ChangeTab[j,Predictors],
DeltaPct = (-(1-exp(PredBeta)^UnitChange))*100)
TmpDat[,LowerConf := DeltaPct -
((-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)))^UnitChange)*100)]
TmpDat[,UpperConf := DeltaPct +
((-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)))^UnitChange)*100)]
}else{
PredColName <- ChangeTab[j,PredCol]
PredVect <- Data[[PredColName]]
TmpDat <- data.table::data.table(
Model = i,
Predictor = ChangeTab[j,Predictors],
DeltaPct = (-(1-exp(PredBeta/(ChangeTab[j,ScaleSd]*stats::sd(PredVect)))^UnitChange))*100)
TmpDat[,LowerConf := DeltaPct -
(-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)/
(ChangeTab[j,ScaleSd]*stats::sd(PredVect)))^UnitChange))*100]
TmpDat[,UpperConf := DeltaPct +
(-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)/
(ChangeTab[j,ScaleSd]*stats::sd(PredVect)))^UnitChange))*100]
}
FullEffects <- c(FullEffects, list(TmpDat))
}
}
data.table::rbindlist(FullEffects)
}
RealEffectTabWide(EcoCountHelper::EpfuNb1Wide, c("Yday", "MoonScale"), c(5, 0.3), ScaleSds = c(NA, 2), PredVects = c(NA, "MoonPct"), Data = SppAccpData)
library(devtools)
data("EpfuNb2Wide")
RealEffectTabWide(EcoCountHelper::EpfuNb2Wide, c("Yday", "MoonScale"), c(5, 0.3), ScaleSds = c(NA, 2), PredVects = c(NA, "MoonPct"), Data = SppAccpData)
RealEffectTabWide(EpfuNb2Wide, c("Yday", "MoonScale"), c(5, 0.3), ScaleSds = c(NA, 2), PredVects = c(NA, "MoonPct"), Data = SppAccpData)
RealEffectTabWide <- function(Models, Predictors, UnitChanges, ConfInt = 95,
ScaleSds = NULL, PredVects = NULL, Data = NULL){
if("glmmTMB" %in% class(Models)){
Models <- deparse(substitute(Models))
}
FullEffects <- list()
ChangeTab <- data.table::data.table(Predictors = Predictors, UnitCh = UnitChanges,
ScaleSd = ScaleSds)
for(i in Models){
TmpMod <- get(i, envir = .GlobalEnv)
for(j in 1:nrow(ChangeTab)){
if(is.na(ChangeTab[j,ScaleSd])==F){ChangeTab[j,PredCol := PredVects[j]]}
Predictor <- ChangeTab[j,Predictors]
UnitChange <- ChangeTab[j,UnitCh]
PredBeta <- summary(TmpMod)$coeff$cond[Predictor,1]
PredSe <- summary(TmpMod)$coeff$cond[Predictor,2]
if(is.na(ChangeTab[j,ScaleSd]) == T){
TmpDat <- data.table::data.table(
Model = i,
Predictor = ChangeTab[j,Predictors],
DeltaPct = (-(1-exp(PredBeta)^UnitChange))*100)
TmpDat[,LowerConf := DeltaPct -
((-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)))^UnitChange)*100)]
TmpDat[,UpperConf := DeltaPct +
((-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)))^UnitChange)*100)]
}else{
PredColName <- ChangeTab[j,PredCol]
PredVect <- Data[[PredColName]]
TmpDat <- data.table::data.table(
Model = i,
Predictor = ChangeTab[j,Predictors],
DeltaPct = (-(1-exp(PredBeta/(ChangeTab[j,ScaleSd]*stats::sd(PredVect)))^UnitChange))*100)
TmpDat[,LowerConf := DeltaPct -
(-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)/
(ChangeTab[j,ScaleSd]*stats::sd(PredVect)))^UnitChange))*100]
TmpDat[,UpperConf := DeltaPct +
(-(1-exp((stats::qnorm(1-((100-ConfInt)/2/100))*PredSe)/
(ChangeTab[j,ScaleSd]*stats::sd(PredVect)))^UnitChange))*100]
}
FullEffects <- c(FullEffects, list(TmpDat))
}
}
data.table::rbindlist(FullEffects)
}
RealEffectTabWide(EpfuNb2Wide, c("Yday", "MoonScale"), c(5, 0.3), ScaleSds = c(NA, 2), PredVects = c(NA, "MoonPct"), Data = SppAccpData, Group)
summary(EpfuNb2Wide)
RealEffectTabWide(EpfuNb2Wide, c("scale2(Yday)", "scale2(MoonPct"), c(5, 0.3), ScaleSds = c(NA, 2), PredVects = c(NA, "MoonPct"), Data = SppAccpData, Group)
RealEffectTabWide(EpfuNb2Wide, c("scale2(Yday)", "scale2(MoonPct"), c(5, 0.3), ScaleSds = c(NA, 2), PredVects = c(NA, "MoonPct"), Data = SppAccpData)
RealEffectTabWide(EpfuNb2Wide, c("scale2(Yday)", "scale2(MoonPct)"), c(5, 0.3), ScaleSds = c(NA, 2), PredVects = c(NA, "MoonPct"), Data = SppAccpData)
summary(EpfuNb2Wide)
RealEffectTabWide(EpfuNb2Wide, c("scale2(Yday)", "scale2(MoonPct)"), c(5, 0.3), ScaleSds = c(NA, 2), PredVects = c(NA, "MoonPct"), Data = SppAccpData)
RealEffectTabWide(EpfuNb2Wide, c("scale2(Yday)", "scale2(MoonPct)"), c(5, 0.3), ScaleSds = c(2, 2), PredVects = c(NA, "MoonPct"), Data = SppAccpData)
RealEffectTabWide(EpfuNb2Wide, c("scale2(Yday)", "scale2(MoonPct)"), c(5, 0.3), ScaleSds = c(2, 2), PredVects = c("Yday", "MoonPct"), Data = SppAccpData)
